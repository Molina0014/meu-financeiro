<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <title>MeuFinanceiro</title>
        <style>
            :root {
                --navy: #1e2a5e;
                --navy-light: #283593;
                --navy-dark: #141d45;
                --pink: #e8638a;
                --pink-light: #f4a5bb;
                --pink-pale: #fce4ec;
                --cream: #fff5f0;
                --cream-dark: #f5e6dc;
                --white: #ffffff;
                --text-dark: #1a1a2e;
                --text-mid: #555570;
                --text-light: #8888a0;
                --green: #4caf50;
                --green-light: #e8f5e9;
                --red: #e53935;
                --red-light: #ffebee;
                --yellow: #ff9800;
                --yellow-light: #fff3e0;
                --blue-light: #e3f2fd;
                --purple: #7c4dff;
                --purple-light: #ede7f6;
                --radius: 18px;
                --radius-sm: 12px;
                --shadow: 0 2px 16px rgba(30, 42, 94, 0.08);
                --shadow-lg: 0 8px 32px rgba(30, 42, 94, 0.12);
                --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    "Helvetica Neue", Arial, sans-serif;
                background: var(--cream);
                color: var(--text-dark);
                min-height: 100vh;
                min-height: 100dvh;
                overflow: hidden;
            }

            .app-container {
                max-width: 430px;
                margin: 0 auto;
                height: 100vh;
                height: 100dvh;
                display: flex;
                flex-direction: column;
                position: relative;
                background: var(--cream);
                overflow: hidden;
            }

            /* Screen area */
            .screen {
                display: none;
                flex: 1;
                overflow-y: auto;
                padding: 20px 16px 100px;
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            .screen.active {
                display: block;
            }

            /* Bottom Nav */
            .bottom-nav {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--white);
                display: flex;
                justify-content: space-around;
                align-items: center;
                padding: 10px 0 max(10px, env(safe-area-inset-bottom));
                border-top: 1px solid rgba(0, 0, 0, 0.04);
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
                z-index: 100;
            }
            .nav-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
                background: none;
                border: none;
                padding: 6px 12px;
                cursor: pointer;
                color: var(--text-light);
                transition: var(--transition);
                font-size: 10px;
                font-weight: 600;
                -webkit-user-select: none;
                user-select: none;
            }
            .nav-item svg {
                width: 24px;
                height: 24px;
                transition: var(--transition);
            }
            .nav-item.active {
                color: var(--navy);
            }
            .nav-item.active svg {
                stroke: var(--navy);
            }

            /* FAB */
            .fab {
                position: absolute;
                bottom: max(75px, calc(65px + env(safe-area-inset-bottom)));
                right: 20px;
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background: linear-gradient(
                    135deg,
                    var(--navy),
                    var(--navy-light)
                );
                color: white;
                border: none;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 28px;
                font-weight: 300;
                box-shadow: 0 4px 20px rgba(30, 42, 94, 0.35);
                cursor: pointer;
                z-index: 101;
                transition: var(--transition);
                -webkit-user-select: none;
                user-select: none;
            }
            .fab:active {
                transform: scale(0.92);
            }

            /* Hero Card */
            .hero-card {
                background: linear-gradient(
                    135deg,
                    var(--navy-dark),
                    var(--navy-light)
                );
                border-radius: var(--radius);
                padding: 28px 24px;
                color: white;
                position: relative;
                overflow: hidden;
                margin-bottom: 20px;
                box-shadow: var(--shadow-lg);
            }
            .hero-card::before {
                content: "";
                position: absolute;
                width: 140px;
                height: 140px;
                border-radius: 50%;
                background: var(--pink);
                opacity: 0.15;
                top: -40px;
                right: -30px;
            }
            .hero-card::after {
                content: "";
                position: absolute;
                width: 80px;
                height: 80px;
                border-radius: 50%;
                background: var(--pink-light);
                opacity: 0.12;
                bottom: -20px;
                left: 30px;
            }
            .hero-label {
                font-size: 13px;
                opacity: 0.7;
                margin-bottom: 6px;
                font-weight: 500;
            }
            .hero-amount {
                font-size: 32px;
                font-weight: 700;
                letter-spacing: -0.5px;
                position: relative;
                z-index: 1;
            }
            .hero-row {
                display: flex;
                gap: 16px;
                margin-top: 20px;
                position: relative;
                z-index: 1;
            }
            .hero-stat {
                flex: 1;
                background: rgba(255, 255, 255, 0.12);
                border-radius: var(--radius-sm);
                padding: 12px;
                backdrop-filter: blur(10px);
            }
            .hero-stat-label {
                font-size: 11px;
                opacity: 0.7;
                margin-bottom: 4px;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .hero-stat-value {
                font-size: 18px;
                font-weight: 700;
            }
            .stat-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                display: inline-block;
            }
            .stat-dot.green {
                background: var(--green);
            }
            .stat-dot.red {
                background: var(--red);
            }

            /* Section headers */
            .section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin: 24px 0 14px;
            }
            .section-title {
                font-size: 17px;
                font-weight: 700;
                color: var(--text-dark);
            }
            .section-link {
                font-size: 13px;
                color: var(--navy);
                font-weight: 600;
                background: none;
                border: none;
                cursor: pointer;
            }

            /* Quick Category Cards */
            .quick-cats {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 8px;
            }
            .quick-cat {
                border-radius: var(--radius-sm);
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                cursor: pointer;
                transition: var(--transition);
                border: none;
                text-align: left;
                font-family: inherit;
            }
            .quick-cat:active {
                transform: scale(0.97);
            }
            .quick-cat-icon {
                width: 40px;
                height: 40px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
            }
            .quick-cat-name {
                font-size: 14px;
                font-weight: 700;
                color: var(--text-dark);
            }
            .quick-cat-info {
                font-size: 11px;
                color: var(--text-mid);
            }

            .qc-food {
                background: var(--yellow-light);
            }
            .qc-food .quick-cat-icon {
                background: rgba(255, 152, 0, 0.2);
            }
            .qc-transport {
                background: var(--blue-light);
            }
            .qc-transport .quick-cat-icon {
                background: rgba(33, 150, 243, 0.2);
            }
            .qc-leisure {
                background: var(--pink-pale);
            }
            .qc-leisure .quick-cat-icon {
                background: rgba(233, 30, 99, 0.2);
            }
            .qc-health {
                background: var(--green-light);
            }
            .qc-health .quick-cat-icon {
                background: rgba(76, 175, 80, 0.2);
            }

            /* Transaction list */
            .tx-list {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            .tx-item {
                display: flex;
                align-items: center;
                gap: 12px;
                background: var(--white);
                border-radius: var(--radius-sm);
                padding: 14px 16px;
                box-shadow: var(--shadow);
                transition: var(--transition);
                cursor: pointer;
            }
            .tx-item:active {
                transform: scale(0.98);
                background: #f8f4f0;
            }
            .tx-icon {
                width: 42px;
                height: 42px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                flex-shrink: 0;
            }
            .tx-info {
                flex: 1;
                min-width: 0;
            }
            .tx-name {
                font-size: 14px;
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .tx-date {
                font-size: 11px;
                color: var(--text-light);
                margin-top: 2px;
            }
            .tx-amount {
                font-size: 15px;
                font-weight: 700;
                text-align: right;
                white-space: nowrap;
            }
            .tx-amount.expense {
                color: var(--red);
            }
            .tx-amount.income {
                color: var(--green);
            }
            .tx-chevron {
                color: var(--text-light);
                font-size: 14px;
                margin-left: 4px;
            }

            /* Stats screen */
            .stats-period {
                display: flex;
                gap: 8px;
                margin-bottom: 20px;
            }
            .period-btn {
                padding: 8px 18px;
                border-radius: 20px;
                border: 1.5px solid var(--cream-dark);
                background: var(--white);
                font-size: 13px;
                font-weight: 600;
                color: var(--text-mid);
                cursor: pointer;
                transition: var(--transition);
            }
            .period-btn.active {
                background: var(--navy);
                color: white;
                border-color: var(--navy);
            }

            .chart-card {
                background: var(--white);
                border-radius: var(--radius);
                padding: 20px;
                box-shadow: var(--shadow);
                margin-bottom: 20px;
            }
            .chart-title {
                font-size: 15px;
                font-weight: 700;
                margin-bottom: 16px;
            }
            .chart-bars {
                display: flex;
                align-items: flex-end;
                gap: 4px;
                height: 140px;
                padding-bottom: 24px;
                position: relative;
                border-bottom: 1px solid #eee;
                overflow: hidden;
            }
            .chart-bar-group {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 6px;
                position: relative;
                height: 100%;
                justify-content: flex-end;
            }
            .chart-bar {
                width: 20px;
                border-radius: 5px 5px 2px 2px;
                transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
            }
            .chart-bar.expense-bar {
                background: linear-gradient(
                    to top,
                    var(--navy),
                    var(--navy-light)
                );
            }
            .chart-bar.income-bar {
                background: linear-gradient(
                    to top,
                    var(--pink),
                    var(--pink-light)
                );
            }
            .chart-bar-label {
                font-size: 10px;
                color: var(--text-light);
                font-weight: 600;
                position: absolute;
                bottom: -20px;
                white-space: nowrap;
            }
            .chart-legend {
                display: flex;
                gap: 20px;
                margin-top: 16px;
                justify-content: center;
            }
            .chart-legend-item {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                font-weight: 600;
            }
            .legend-dot {
                width: 10px;
                height: 10px;
                border-radius: 3px;
            }

            /* Category stats list */
            .cat-stat-item {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 14px 0;
                border-bottom: 1px solid #f0ece8;
            }
            .cat-stat-item:last-child {
                border-bottom: none;
            }
            .cat-stat-icon {
                width: 40px;
                height: 40px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
            }
            .cat-stat-info {
                flex: 1;
            }
            .cat-stat-name {
                font-size: 14px;
                font-weight: 600;
            }
            .cat-stat-bar {
                height: 6px;
                border-radius: 3px;
                background: #f0ece8;
                margin-top: 6px;
                overflow: hidden;
            }
            .cat-stat-bar-fill {
                height: 100%;
                border-radius: 3px;
                transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .cat-stat-value {
                font-size: 14px;
                font-weight: 700;
                white-space: nowrap;
            }

            /* Goals screen */
            .goal-card {
                background: var(--white);
                border-radius: var(--radius);
                padding: 20px;
                box-shadow: var(--shadow);
                margin-bottom: 14px;
            }
            .goal-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 14px;
            }
            .goal-icon {
                width: 44px;
                height: 44px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 22px;
            }
            .goal-title {
                font-size: 15px;
                font-weight: 700;
            }
            .goal-subtitle {
                font-size: 12px;
                color: var(--text-light);
                margin-top: 2px;
            }
            .goal-progress-bar {
                height: 10px;
                border-radius: 5px;
                background: #f0ece8;
                overflow: hidden;
                margin-bottom: 10px;
            }
            .goal-progress-fill {
                height: 100%;
                border-radius: 5px;
                transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .goal-footer {
                display: flex;
                justify-content: space-between;
                font-size: 12px;
                color: var(--text-mid);
            }
            .goal-footer strong {
                color: var(--text-dark);
            }

            .goal-add-btn {
                width: 100%;
                padding: 16px;
                border-radius: var(--radius-sm);
                border: 2px dashed var(--cream-dark);
                background: transparent;
                color: var(--text-light);
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: var(--transition);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }
            .goal-add-btn:active {
                border-color: var(--navy);
                color: var(--navy);
            }

            /* Modal overlay */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.4);
                backdrop-filter: blur(4px);
                z-index: 200;
                display: none;
                align-items: flex-end;
                justify-content: center;
            }
            .modal-overlay.active {
                display: flex;
            }

            .modal {
                background: var(--white);
                border-radius: 24px 24px 0 0;
                width: 100%;
                max-width: 430px;
                max-height: 90vh;
                overflow-y: auto;
                padding: 8px 20px 32px;
                animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            @keyframes slideUp {
                from {
                    transform: translateY(100%);
                }
                to {
                    transform: translateY(0);
                }
            }
            .modal-handle {
                width: 40px;
                height: 4px;
                border-radius: 2px;
                background: #ddd;
                margin: 8px auto 20px;
            }
            .modal-title {
                font-size: 18px;
                font-weight: 700;
                margin-bottom: 20px;
                text-align: center;
            }

            .form-group {
                margin-bottom: 16px;
            }
            .form-label {
                font-size: 12px;
                font-weight: 600;
                color: var(--text-mid);
                margin-bottom: 6px;
                display: block;
            }
            .form-input {
                width: 100%;
                padding: 14px 16px;
                border: 1.5px solid #e8e4e0;
                border-radius: var(--radius-sm);
                font-size: 15px;
                font-family: inherit;
                background: var(--cream);
                color: var(--text-dark);
                transition: var(--transition);
                -webkit-appearance: none;
            }
            .form-input:focus {
                outline: none;
                border-color: var(--navy);
                background: white;
            }

            .type-toggle {
                display: flex;
                gap: 8px;
            }
            .type-btn {
                flex: 1;
                padding: 12px;
                border-radius: var(--radius-sm);
                border: 1.5px solid #e8e4e0;
                background: var(--white);
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: var(--transition);
                text-align: center;
            }
            .type-btn.active-expense {
                background: var(--red-light);
                border-color: var(--red);
                color: var(--red);
            }
            .type-btn.active-income {
                background: var(--green-light);
                border-color: var(--green);
                color: var(--green);
            }

            .form-submit {
                width: 100%;
                padding: 16px;
                border-radius: var(--radius-sm);
                background: linear-gradient(
                    135deg,
                    var(--navy),
                    var(--navy-light)
                );
                color: white;
                border: none;
                font-size: 16px;
                font-weight: 700;
                cursor: pointer;
                transition: var(--transition);
                margin-top: 8px;
            }
            .form-submit:active {
                transform: scale(0.98);
                opacity: 0.9;
            }

            /* Goal modal extras */
            .form-cats-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            .form-cat-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
                padding: 10px 4px;
                border-radius: var(--radius-sm);
                border: 1.5px solid #e8e4e0;
                background: white;
                cursor: pointer;
                transition: var(--transition);
                font-size: 10px;
                font-weight: 600;
                color: var(--text-mid);
            }
            .form-cat-btn .cat-emoji {
                font-size: 22px;
            }
            .form-cat-btn.active {
                border-color: var(--navy);
                background: var(--blue-light);
                color: var(--navy);
            }

            /* Filter bar for transactions */
            .filter-bar {
                display: flex;
                gap: 8px;
                margin-bottom: 16px;
                overflow-x: auto;
                padding-bottom: 4px;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .filter-bar::-webkit-scrollbar {
                display: none;
            }
            .filter-chip {
                padding: 8px 16px;
                border-radius: 20px;
                border: 1.5px solid var(--cream-dark);
                background: var(--white);
                font-size: 12px;
                font-weight: 600;
                color: var(--text-mid);
                cursor: pointer;
                transition: var(--transition);
                white-space: nowrap;
                flex-shrink: 0;
            }
            .filter-chip.active {
                background: var(--navy);
                color: white;
                border-color: var(--navy);
            }

            /* Screen title */
            .screen-title {
                font-size: 22px;
                font-weight: 800;
                margin-bottom: 20px;
            }

            /* Empty state */
            .empty-state {
                text-align: center;
                padding: 40px 20px;
                color: var(--text-light);
            }
            .empty-state-icon {
                font-size: 48px;
                margin-bottom: 12px;
            }
            .empty-state-text {
                font-size: 14px;
            }

            /* Confirm dialog */
            .confirm-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.45);
                backdrop-filter: blur(4px);
                z-index: 300;
                display: none;
                align-items: center;
                justify-content: center;
            }
            .confirm-overlay.active {
                display: flex;
            }
            .confirm-box {
                background: white;
                border-radius: var(--radius);
                padding: 28px 24px;
                max-width: 320px;
                width: 90%;
                text-align: center;
                box-shadow: var(--shadow-lg);
            }
            .confirm-box p {
                font-size: 15px;
                font-weight: 600;
                margin-bottom: 20px;
                line-height: 1.5;
            }
            .confirm-actions {
                display: flex;
                gap: 10px;
            }
            .confirm-actions button {
                flex: 1;
                padding: 12px;
                border-radius: var(--radius-sm);
                font-size: 14px;
                font-weight: 700;
                cursor: pointer;
                border: none;
                transition: var(--transition);
            }
            .btn-cancel {
                background: #f0ece8;
                color: var(--text-mid);
            }
            .btn-danger {
                background: var(--red);
                color: white;
            }

            /* Scrollbar */
            .screen::-webkit-scrollbar {
                width: 0;
            }

            /* Subtle animations */
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(8px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .animate-in {
                animation: fadeIn 0.35s ease-out;
            }

            /* Category colors */
            .cat-alimentacao {
                background: var(--yellow-light);
            }
            .cat-alimentacao .cat-stat-bar-fill {
                background: var(--yellow);
            }
            .cat-transporte {
                background: var(--blue-light);
            }
            .cat-transporte .cat-stat-bar-fill {
                background: #2196f3;
            }
            .cat-lazer {
                background: var(--pink-pale);
            }
            .cat-lazer .cat-stat-bar-fill {
                background: var(--pink);
            }
            .cat-saude {
                background: var(--green-light);
            }
            .cat-saude .cat-stat-bar-fill {
                background: var(--green);
            }
            .cat-educacao {
                background: var(--purple-light);
            }
            .cat-educacao .cat-stat-bar-fill {
                background: var(--purple);
            }
            .cat-moradia {
                background: #e0f2f1;
            }
            .cat-moradia .cat-stat-bar-fill {
                background: #009688;
            }
            .cat-salario {
                background: var(--green-light);
            }
            .cat-salario .cat-stat-bar-fill {
                background: var(--green);
            }
            .cat-outros {
                background: #f5f5f5;
            }
            .cat-outros .cat-stat-bar-fill {
                background: #9e9e9e;
            }

            /* Progress colors for goals */
            .progress-green {
                background: linear-gradient(90deg, #4caf50, #66bb6a);
            }
            .progress-yellow {
                background: linear-gradient(90deg, #ff9800, #ffb74d);
            }
            .progress-red {
                background: linear-gradient(90deg, #e53935, #ef5350);
            }
            .progress-navy {
                background: linear-gradient(
                    90deg,
                    var(--navy),
                    var(--navy-light)
                );
            }

            /* Delete button on swipe (shown on long press) */
            .tx-delete {
                background: var(--red);
                color: white;
                border: none;
                padding: 6px 12px;
                border-radius: 8px;
                font-size: 11px;
                font-weight: 600;
                cursor: pointer;
                margin-left: 8px;
                flex-shrink: 0;
                display: none;
                transition: var(--transition);
            }
            .tx-item.show-delete .tx-delete {
                display: block;
            }
            .tx-item.show-delete .tx-chevron {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="app-container">
            <!-- ===== HOME SCREEN ===== -->
            <div class="screen active" id="screen-home">
                <div class="hero-card animate-in">
                    <div class="hero-label">Saldo atual</div>
                    <div class="hero-amount" id="home-balance">R$ 0,00</div>
                    <div class="hero-row">
                        <div class="hero-stat">
                            <div class="hero-stat-label">
                                <span class="stat-dot green"></span> Receitas
                            </div>
                            <div class="hero-stat-value" id="home-income">
                                R$ 0
                            </div>
                        </div>
                        <div class="hero-stat">
                            <div class="hero-stat-label">
                                <span class="stat-dot red"></span> Despesas
                            </div>
                            <div class="hero-stat-value" id="home-expenses">
                                R$ 0
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <span class="section-title">Categorias</span>
                </div>
                <div class="quick-cats" id="home-quick-cats"></div>

                <div class="section-header">
                    <span class="section-title">Transa√ß√µes recentes</span>
                    <button
                        class="section-link"
                        onclick="switchTab('transactions')"
                    >
                        Ver todas
                    </button>
                </div>
                <div class="tx-list" id="home-tx-list"></div>
            </div>

            <!-- ===== TRANSACTIONS SCREEN ===== -->
            <div class="screen" id="screen-transactions">
                <div class="screen-title">Transa√ß√µes</div>
                <div class="filter-bar" id="tx-filter-bar"></div>
                <div class="tx-list" id="all-tx-list"></div>
            </div>

            <!-- ===== STATS SCREEN ===== -->
            <div class="screen" id="screen-stats">
                <div class="screen-title">Estat√≠sticas</div>
                <div class="stats-period">
                    <button
                        class="period-btn active"
                        data-period="month"
                        onclick="setPeriod('month')"
                    >
                        Este m√™s
                    </button>
                    <button
                        class="period-btn"
                        data-period="week"
                        onclick="setPeriod('week')"
                    >
                        Semana
                    </button>
                    <button
                        class="period-btn"
                        data-period="all"
                        onclick="setPeriod('all')"
                    >
                        Tudo
                    </button>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Receitas vs Despesas</div>
                    <div class="chart-bars" id="stats-chart"></div>
                    <div class="chart-legend">
                        <div class="chart-legend-item">
                            <div
                                class="legend-dot"
                                style="background: var(--navy)"
                            ></div>
                            Despesas
                        </div>
                        <div class="chart-legend-item">
                            <div
                                class="legend-dot"
                                style="background: var(--pink)"
                            ></div>
                            Receitas
                        </div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Gastos por categoria</div>
                    <div id="stats-categories"></div>
                </div>
            </div>

            <!-- ===== GOALS SCREEN ===== -->
            <div class="screen" id="screen-goals">
                <div class="screen-title">Metas</div>
                <div id="goals-list"></div>
                <button class="goal-add-btn" onclick="openGoalModal()">
                    <svg
                        width="18"
                        height="18"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2.5"
                        stroke-linecap="round"
                    >
                        <line x1="9" y1="3" x2="9" y2="15" />
                        <line x1="3" y1="9" x2="15" y2="9" />
                    </svg>
                    Adicionar meta
                </button>
            </div>

            <!-- FAB -->
            <button class="fab" id="fab-btn" onclick="openTxModal()">
                <svg
                    width="24"
                    height="24"
                    fill="none"
                    stroke="white"
                    stroke-width="2.5"
                    stroke-linecap="round"
                >
                    <line x1="12" y1="5" x2="12" y2="19" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
            </button>

            <!-- Bottom Navigation -->
            <nav class="bottom-nav">
                <button
                    class="nav-item active"
                    data-tab="home"
                    onclick="switchTab('home')"
                >
                    <svg
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                        />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    Home
                </button>
                <button
                    class="nav-item"
                    data-tab="transactions"
                    onclick="switchTab('transactions')"
                >
                    <svg
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        viewBox="0 0 24 24"
                    >
                        <line x1="12" y1="1" x2="12" y2="23" />
                        <path
                            d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                        />
                    </svg>
                    Transa√ß√µes
                </button>
                <button
                    class="nav-item"
                    data-tab="stats"
                    onclick="switchTab('stats')"
                >
                    <svg
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        viewBox="0 0 24 24"
                    >
                        <line x1="18" y1="20" x2="18" y2="10" />
                        <line x1="12" y1="20" x2="12" y2="4" />
                        <line x1="6" y1="20" x2="6" y2="14" />
                    </svg>
                    Estat√≠sticas
                </button>
                <button
                    class="nav-item"
                    data-tab="goals"
                    onclick="switchTab('goals')"
                >
                    <svg
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        viewBox="0 0 24 24"
                    >
                        <circle cx="12" cy="12" r="10" />
                        <circle cx="12" cy="12" r="6" />
                        <circle cx="12" cy="12" r="2" />
                    </svg>
                    Metas
                </button>
            </nav>
        </div>

        <!-- Transaction Modal -->
        <div class="modal-overlay" id="tx-modal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-title">Nova transa√ß√£o</div>
                <form id="tx-form" onsubmit="saveTx(event)">
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <div class="type-toggle">
                            <button
                                type="button"
                                class="type-btn active-expense"
                                data-type="expense"
                                onclick="setTxType('expense')"
                            >
                                Despesa
                            </button>
                            <button
                                type="button"
                                class="type-btn"
                                data-type="income"
                                onclick="setTxType('income')"
                            >
                                Receita
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor (R$)</label>
                        <input
                            type="number"
                            step="0.01"
                            min="0.01"
                            class="form-input"
                            id="tx-value"
                            placeholder="0,00"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <input
                            type="text"
                            class="form-input"
                            id="tx-desc"
                            placeholder="Ex: Supermercado"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <div class="form-cats-grid" id="tx-cats-grid"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input
                            type="date"
                            class="form-input"
                            id="tx-date"
                            required
                        />
                    </div>
                    <button type="submit" class="form-submit">
                        Salvar transa√ß√£o
                    </button>
                </form>
            </div>
        </div>

        <!-- Goal Modal -->
        <div class="modal-overlay" id="goal-modal">
            <div class="modal">
                <div class="modal-handle"></div>
                <div class="modal-title">Nova meta</div>
                <form id="goal-form" onsubmit="saveGoal(event)">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <div class="form-cats-grid" id="goal-cats-grid"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Limite mensal (R$)</label>
                        <input
                            type="number"
                            step="0.01"
                            min="1"
                            class="form-input"
                            id="goal-limit"
                            placeholder="500,00"
                            required
                        />
                    </div>
                    <button type="submit" class="form-submit">
                        Salvar meta
                    </button>
                </form>
            </div>
        </div>

        <!-- Confirm dialog -->
        <div class="confirm-overlay" id="confirm-overlay">
            <div class="confirm-box">
                <p id="confirm-msg">Tem certeza?</p>
                <div class="confirm-actions">
                    <button class="btn-cancel" onclick="closeConfirm()">
                        Cancelar
                    </button>
                    <button class="btn-danger" id="confirm-yes">Excluir</button>
                </div>
            </div>
        </div>

        <script>
            // ========================
            // DATA & STATE
            // ========================
            const CATEGORIES = {
                alimentacao: {
                    name: "Alimenta√ß√£o",
                    emoji: "üçî",
                    color: "#ff9800",
                },
                transporte: {
                    name: "Transporte",
                    emoji: "üöó",
                    color: "#2196f3",
                },
                lazer: { name: "Lazer", emoji: "üéÆ", color: "#e8638a" },
                saude: { name: "Sa√∫de", emoji: "üíä", color: "#4caf50" },
                educacao: { name: "Educa√ß√£o", emoji: "üìö", color: "#7c4dff" },
                moradia: { name: "Moradia", emoji: "üè†", color: "#009688" },
                salario: { name: "Sal√°rio", emoji: "üí∞", color: "#4caf50" },
                outros: { name: "Outros", emoji: "üì¶", color: "#9e9e9e" },
            };

            const EXPENSE_CATS = [
                "alimentacao",
                "transporte",
                "lazer",
                "saude",
                "educacao",
                "moradia",
                "outros",
            ];
            const INCOME_CATS = ["salario", "outros"];

            let state = {
                transactions: [],
                goals: [],
                txType: "expense",
                txCategory: "alimentacao",
                goalCategory: "alimentacao",
                activePeriod: "month",
                activeFilter: "all",
            };

            // ========================
            // API CLIENT
            // ========================
            const API = "";

            async function api(path, opts = {}) {
                const fetchOpts = { ...opts };
                // S√≥ envia Content-Type em requests com body (POST/PUT)
                if (opts.body) {
                    fetchOpts.headers = {
                        "Content-Type": "application/json",
                        ...opts.headers,
                    };
                }
                const res = await fetch(API + path, fetchOpts);
                if (!res.ok) {
                    const body = await res.json().catch(() => ({}));
                    throw new Error(body.error || `Erro ${res.status}`);
                }
                return res.json();
            }

            function mapTxFromApi(row) {
                return {
                    id: Number(row.id),
                    type: row.type,
                    category: row.category,
                    desc: row.description || "",
                    amount: Number(row.amount),
                    date: String(row.date),
                };
            }

            function mapGoalFromApi(row) {
                return {
                    id: Number(row.id),
                    category: row.category,
                    limit: Number(row.monthly_limit),
                };
            }

            // ========================
            // PERSISTENCE (API + localStorage fallback)
            // ========================
            async function loadState() {
                try {
                    const [txs, goals] = await Promise.all([
                        api("/api/transactions?limit=500"),
                        api("/api/goals"),
                    ]);
                    state.transactions = txs.map(mapTxFromApi);
                    state.goals = goals.map(mapGoalFromApi);
                    // Salva cache local para fallback offline
                    localStorage.setItem(
                        "financeiro_cache",
                        JSON.stringify({
                            transactions: state.transactions,
                            goals: state.goals,
                        }),
                    );
                } catch (e) {
                    console.warn(
                        "API indispon√≠vel, usando cache local:",
                        e.message,
                    );
                    try {
                        const cached = JSON.parse(
                            localStorage.getItem("financeiro_cache") || "null",
                        );
                        if (cached) {
                            state.transactions = cached.transactions || [];
                            state.goals = cached.goals || [];
                        }
                    } catch (e2) {
                        /* sem cache */
                    }
                }
            }

            // ========================
            // UTILS
            // ========================
            function formatMoney(v) {
                return (
                    "R$ " +
                    Number(v).toLocaleString("pt-BR", {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                    })
                );
            }

            function formatDate(ds) {
                const d = new Date(ds + "T12:00:00");
                return d.toLocaleDateString("pt-BR", {
                    day: "2-digit",
                    month: "short",
                });
            }

            function formatDateFull(ds) {
                const d = new Date(ds + "T12:00:00");
                return d.toLocaleDateString("pt-BR", {
                    day: "2-digit",
                    month: "long",
                    year: "numeric",
                });
            }

            function isThisMonth(ds) {
                const d = new Date(ds + "T12:00:00");
                const now = new Date();
                return (
                    d.getMonth() === now.getMonth() &&
                    d.getFullYear() === now.getFullYear()
                );
            }

            function isThisWeek(ds) {
                const d = new Date(ds + "T12:00:00");
                const now = new Date();
                const weekStart = new Date(now);
                weekStart.setDate(now.getDate() - now.getDay());
                weekStart.setHours(0, 0, 0, 0);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 7);
                return d >= weekStart && d < weekEnd;
            }

            function filterTx(period, category) {
                let txs = [...state.transactions];
                if (period === "month")
                    txs = txs.filter((t) => isThisMonth(t.date));
                else if (period === "week")
                    txs = txs.filter((t) => isThisWeek(t.date));
                if (category && category !== "all")
                    txs = txs.filter((t) => t.category === category);
                return txs.sort(
                    (a, b) => b.date.localeCompare(a.date) || b.id - a.id,
                );
            }

            function getMonthlyExpenses(category) {
                return state.transactions
                    .filter(
                        (t) =>
                            t.type === "expense" &&
                            isThisMonth(t.date) &&
                            t.category === category,
                    )
                    .reduce((s, t) => s + t.amount, 0);
            }

            // ========================
            // NAVIGATION
            // ========================
            function switchTab(tab) {
                document
                    .querySelectorAll(".screen")
                    .forEach((s) => s.classList.remove("active"));
                document
                    .getElementById("screen-" + tab)
                    .classList.add("active");
                document
                    .querySelectorAll(".nav-item")
                    .forEach((n) => n.classList.remove("active"));
                document
                    .querySelector(`.nav-item[data-tab="${tab}"]`)
                    .classList.add("active");
                renderCurrentScreen(tab);
            }

            function renderCurrentScreen(tab) {
                if (tab === "home") renderHome();
                else if (tab === "transactions") renderTransactions();
                else if (tab === "stats") renderStats();
                else if (tab === "goals") renderGoals();
            }

            // ========================
            // HOME SCREEN
            // ========================
            function renderHome() {
                const monthTxs = filterTx("month");
                const income = monthTxs
                    .filter((t) => t.type === "income")
                    .reduce((s, t) => s + t.amount, 0);
                const expenses = monthTxs
                    .filter((t) => t.type === "expense")
                    .reduce((s, t) => s + t.amount, 0);
                const balance = income - expenses;

                document.getElementById("home-balance").textContent =
                    formatMoney(balance);
                document.getElementById("home-income").textContent =
                    formatMoney(income);
                document.getElementById("home-expenses").textContent =
                    formatMoney(expenses);

                // Quick categories - top 4 expense categories
                const catTotals = {};
                monthTxs
                    .filter((t) => t.type === "expense")
                    .forEach((t) => {
                        catTotals[t.category] =
                            (catTotals[t.category] || 0) + t.amount;
                    });
                const topCats = Object.entries(catTotals)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 4);
                const qcClasses = [
                    "qc-food",
                    "qc-transport",
                    "qc-leisure",
                    "qc-health",
                ];

                const qcContainer = document.getElementById("home-quick-cats");
                if (topCats.length) {
                    qcContainer.innerHTML = topCats
                        .map(([catKey, total], i) => {
                            const cat = CATEGORIES[catKey];
                            const txCount = monthTxs.filter(
                                (t) =>
                                    t.category === catKey &&
                                    t.type === "expense",
                            ).length;
                            return `<button class="quick-cat ${qcClasses[i % 4]}" onclick="switchTab('transactions');setTimeout(()=>setFilter('${catKey}'),50)">
        <div class="quick-cat-icon">${cat.emoji}</div>
        <div class="quick-cat-name">${cat.name}</div>
        <div class="quick-cat-info">${txCount} transa√ß${txCount === 1 ? "√£o" : "√µes"} ¬∑ ${formatMoney(total)}</div>
      </button>`;
                        })
                        .join("");
                } else {
                    qcContainer.innerHTML = "";
                }

                // Recent transactions
                const recent = filterTx("month").slice(0, 5);
                const txList = document.getElementById("home-tx-list");
                if (recent.length) {
                    txList.innerHTML = recent
                        .map((t) => txItemHTML(t))
                        .join("");
                } else {
                    txList.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì≠</div><div class="empty-state-text">Nenhuma transa√ß√£o este m√™s</div></div>`;
                }
            }

            function txItemHTML(t) {
                const cat = CATEGORIES[t.category] || CATEGORIES.outros;
                const isExp = t.type === "expense";
                return `<div class="tx-item" data-id="${t.id}" onclick="toggleDeleteTx(this)" ontouchstart="" >
    <div class="tx-icon cat-${t.category}">${cat.emoji}</div>
    <div class="tx-info">
      <div class="tx-name">${t.desc}</div>
      <div class="tx-date">${formatDate(t.date)}</div>
    </div>
    <div class="tx-amount ${isExp ? "expense" : "income"}">${isExp ? "-" : "+"}${formatMoney(t.amount)}</div>
    <span class="tx-chevron">‚Ä∫</span>
    <button class="tx-delete" onclick="event.stopPropagation();confirmDeleteTx(${t.id})">Excluir</button>
  </div>`;
            }

            function toggleDeleteTx(el) {
                const wasOpen = el.classList.contains("show-delete");
                document
                    .querySelectorAll(".tx-item.show-delete")
                    .forEach((i) => i.classList.remove("show-delete"));
                if (!wasOpen) el.classList.add("show-delete");
            }

            // ========================
            // TRANSACTIONS SCREEN
            // ========================
            function renderTransactions() {
                // Filter bar
                const filterBar = document.getElementById("tx-filter-bar");
                const cats = ["all", ...EXPENSE_CATS];
                filterBar.innerHTML = cats
                    .map((c) => {
                        const label =
                            c === "all" ? "Todas" : CATEGORIES[c].name;
                        return `<button class="filter-chip ${state.activeFilter === c ? "active" : ""}" onclick="setFilter('${c}')">${c !== "all" ? CATEGORIES[c].emoji + " " : ""}${label}</button>`;
                    })
                    .join("");

                const txs = filterTx("all", state.activeFilter);
                const txList = document.getElementById("all-tx-list");
                if (txs.length) {
                    txList.innerHTML = txs.map((t) => txItemHTML(t)).join("");
                } else {
                    txList.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üîç</div><div class="empty-state-text">Nenhuma transa√ß√£o encontrada</div></div>`;
                }
            }

            function setFilter(f) {
                state.activeFilter = f;
                renderTransactions();
            }

            // ========================
            // STATS SCREEN
            // ========================
            function renderStats() {
                renderChart();
                renderCategoryStats();
            }

            function setPeriod(p) {
                state.activePeriod = p;
                document
                    .querySelectorAll(".period-btn")
                    .forEach((b) =>
                        b.classList.toggle("active", b.dataset.period === p),
                    );
                renderStats();
            }

            function renderChart() {
                const container = document.getElementById("stats-chart");
                // Get last 6 months of data
                const now = new Date();
                const months = [];
                for (let i = 5; i >= 0; i--) {
                    const d = new Date(
                        now.getFullYear(),
                        now.getMonth() - i,
                        1,
                    );
                    months.push({
                        year: d.getFullYear(),
                        month: d.getMonth(),
                        label: d
                            .toLocaleDateString("pt-BR", { month: "short" })
                            .replace(".", ""),
                    });
                }

                const data = months.map((m) => {
                    const txs = state.transactions.filter((t) => {
                        const td = new Date(t.date + "T12:00:00");
                        return (
                            td.getMonth() === m.month &&
                            td.getFullYear() === m.year
                        );
                    });
                    return {
                        label: m.label,
                        income: txs
                            .filter((t) => t.type === "income")
                            .reduce((s, t) => s + t.amount, 0),
                        expense: txs
                            .filter((t) => t.type === "expense")
                            .reduce((s, t) => s + t.amount, 0),
                    };
                });

                const maxVal = Math.max(
                    ...data.map((d) => Math.max(d.income, d.expense)),
                    1,
                );

                container.innerHTML = data
                    .map((d) => {
                        const expH = Math.max(
                            (d.expense / maxVal) * 110,
                            d.expense > 0 ? 4 : 0,
                        );
                        const incH = Math.max(
                            (d.income / maxVal) * 110,
                            d.income > 0 ? 4 : 0,
                        );
                        return `<div class="chart-bar-group">
      <div style="display:flex;gap:3px;align-items:flex-end;height:100%">
        <div class="chart-bar expense-bar" style="height:${expH}px"></div>
        <div class="chart-bar income-bar" style="height:${incH}px"></div>
      </div>
      <span class="chart-bar-label">${d.label}</span>
    </div>`;
                    })
                    .join("");
            }

            function renderCategoryStats() {
                const container = document.getElementById("stats-categories");
                const txs = filterTx(state.activePeriod).filter(
                    (t) => t.type === "expense",
                );
                const totals = {};
                txs.forEach((t) => {
                    totals[t.category] = (totals[t.category] || 0) + t.amount;
                });
                const sorted = Object.entries(totals).sort(
                    (a, b) => b[1] - a[1],
                );
                const maxVal = sorted.length ? sorted[0][1] : 1;

                if (!sorted.length) {
                    container.innerHTML = `<div class="empty-state"><div class="empty-state-text">Sem despesas neste per√≠odo</div></div>`;
                    return;
                }

                container.innerHTML = sorted
                    .map(([catKey, total]) => {
                        const cat = CATEGORIES[catKey] || CATEGORIES.outros;
                        const pct = (total / maxVal) * 100;
                        return `<div class="cat-stat-item">
      <div class="cat-stat-icon cat-${catKey}">${cat.emoji}</div>
      <div class="cat-stat-info">
        <div class="cat-stat-name">${cat.name}</div>
        <div class="cat-stat-bar"><div class="cat-stat-bar-fill" style="width:${pct}%;background:${cat.color}"></div></div>
      </div>
      <div class="cat-stat-value">${formatMoney(total)}</div>
    </div>`;
                    })
                    .join("");
            }

            // ========================
            // GOALS SCREEN
            // ========================
            function renderGoals() {
                const container = document.getElementById("goals-list");
                if (!state.goals.length) {
                    container.innerHTML = `<div class="empty-state" style="margin-bottom:20px"><div class="empty-state-icon">üéØ</div><div class="empty-state-text">Nenhuma meta definida ainda</div></div>`;
                    return;
                }

                container.innerHTML = state.goals
                    .map((g) => {
                        const cat = CATEGORIES[g.category] || CATEGORIES.outros;
                        const spent = getMonthlyExpenses(g.category);
                        const pct = Math.min((spent / g.limit) * 100, 100);
                        const remaining = Math.max(g.limit - spent, 0);
                        let progressClass = "progress-navy";
                        if (pct >= 90) progressClass = "progress-red";
                        else if (pct >= 70) progressClass = "progress-yellow";
                        else progressClass = "progress-green";

                        return `<div class="goal-card animate-in">
      <div class="goal-header">
        <div class="goal-icon cat-${g.category}">${cat.emoji}</div>
        <div>
          <div class="goal-title">${cat.name}</div>
          <div class="goal-subtitle">Limite: ${formatMoney(g.limit)}/m√™s</div>
        </div>
      </div>
      <div class="goal-progress-bar"><div class="goal-progress-fill ${progressClass}" style="width:${pct}%"></div></div>
      <div class="goal-footer">
        <span>Gasto: <strong>${formatMoney(spent)}</strong></span>
        <span>Restante: <strong>${formatMoney(remaining)}</strong></span>
      </div>
      <div style="text-align:right;margin-top:10px">
        <button style="background:none;border:none;color:var(--red);font-size:12px;font-weight:600;cursor:pointer;padding:4px 8px" onclick="confirmDeleteGoal(${g.id})">Remover meta</button>
      </div>
    </div>`;
                    })
                    .join("");
            }

            // ========================
            // TRANSACTION MODAL
            // ========================
            function openTxModal() {
                state.txType = "expense";
                state.txCategory = "alimentacao";
                document.getElementById("tx-form").reset();
                document.getElementById("tx-date").value = new Date()
                    .toISOString()
                    .split("T")[0];
                updateTxTypeUI();
                renderTxCats();
                document.getElementById("tx-modal").classList.add("active");
            }

            function closeTxModal() {
                document.getElementById("tx-modal").classList.remove("active");
            }

            function setTxType(type) {
                state.txType = type;
                state.txCategory =
                    type === "expense" ? "alimentacao" : "salario";
                updateTxTypeUI();
                renderTxCats();
            }

            function updateTxTypeUI() {
                document
                    .querySelectorAll("#tx-modal .type-btn")
                    .forEach((b) => {
                        b.classList.remove("active-expense", "active-income");
                        if (b.dataset.type === state.txType) {
                            b.classList.add(
                                state.txType === "expense"
                                    ? "active-expense"
                                    : "active-income",
                            );
                        }
                    });
            }

            function renderTxCats() {
                const cats =
                    state.txType === "expense" ? EXPENSE_CATS : INCOME_CATS;
                document.getElementById("tx-cats-grid").innerHTML = cats
                    .map((c) => {
                        const cat = CATEGORIES[c];
                        return `<button type="button" class="form-cat-btn ${state.txCategory === c ? "active" : ""}" onclick="state.txCategory='${c}';renderTxCats()">
      <span class="cat-emoji">${cat.emoji}</span>
      ${cat.name}
    </button>`;
                    })
                    .join("");
            }

            async function saveTx(e) {
                e.preventDefault();
                const amount = parseFloat(
                    document.getElementById("tx-value").value,
                );
                const desc = document.getElementById("tx-desc").value.trim();
                const date = document.getElementById("tx-date").value;
                if (!amount || !desc || !date) return;

                try {
                    const row = await api("/api/transactions", {
                        method: "POST",
                        body: JSON.stringify({
                            type: state.txType,
                            category: state.txCategory,
                            description: desc,
                            amount,
                            date,
                        }),
                    });
                    state.transactions.unshift(mapTxFromApi(row));
                    closeTxModal();
                    renderCurrentScreen(getActiveTab());
                } catch (err) {
                    alert("Erro ao salvar: " + err.message);
                }
            }

            // ========================
            // GOAL MODAL
            // ========================
            function openGoalModal() {
                state.goalCategory = "alimentacao";
                document.getElementById("goal-form").reset();
                renderGoalCats();
                document.getElementById("goal-modal").classList.add("active");
            }

            function closeGoalModal() {
                document
                    .getElementById("goal-modal")
                    .classList.remove("active");
            }

            function renderGoalCats() {
                document.getElementById("goal-cats-grid").innerHTML =
                    EXPENSE_CATS.map((c) => {
                        const cat = CATEGORIES[c];
                        return `<button type="button" class="form-cat-btn ${state.goalCategory === c ? "active" : ""}" onclick="state.goalCategory='${c}';renderGoalCats()">
      <span class="cat-emoji">${cat.emoji}</span>
      ${cat.name}
    </button>`;
                    }).join("");
            }

            async function saveGoal(e) {
                e.preventDefault();
                const limit = parseFloat(
                    document.getElementById("goal-limit").value,
                );
                if (!limit) return;

                try {
                    const row = await api("/api/goals", {
                        method: "POST",
                        body: JSON.stringify({
                            category: state.goalCategory,
                            monthly_limit: limit,
                        }),
                    });
                    // Upsert: remove existing for same category, add new
                    state.goals = state.goals.filter(
                        (g) => g.category !== state.goalCategory,
                    );
                    state.goals.push(mapGoalFromApi(row));
                    closeGoalModal();
                    renderGoals();
                } catch (err) {
                    alert("Erro ao salvar meta: " + err.message);
                }
            }

            // ========================
            // DELETE
            // ========================
            let pendingDeleteAction = null;

            function confirmDeleteTx(id) {
                document.getElementById("confirm-msg").textContent =
                    "Excluir esta transa√ß√£o?";
                pendingDeleteAction = async () => {
                    try {
                        await api("/api/transactions/" + id, {
                            method: "DELETE",
                        });
                        state.transactions = state.transactions.filter(
                            (t) => t.id !== id,
                        );
                        renderCurrentScreen(getActiveTab());
                    } catch (err) {
                        alert("Erro ao excluir: " + err.message);
                    }
                };
                document
                    .getElementById("confirm-overlay")
                    .classList.add("active");
            }

            function confirmDeleteGoal(id) {
                document.getElementById("confirm-msg").textContent =
                    "Remover esta meta?";
                pendingDeleteAction = async () => {
                    try {
                        await api("/api/goals/" + id, { method: "DELETE" });
                        state.goals = state.goals.filter((g) => g.id !== id);
                        renderGoals();
                    } catch (err) {
                        alert("Erro ao excluir meta: " + err.message);
                    }
                };
                document
                    .getElementById("confirm-overlay")
                    .classList.add("active");
            }

            document
                .getElementById("confirm-yes")
                .addEventListener("click", () => {
                    if (pendingDeleteAction) pendingDeleteAction();
                    closeConfirm();
                });

            function closeConfirm() {
                document
                    .getElementById("confirm-overlay")
                    .classList.remove("active");
                pendingDeleteAction = null;
            }

            // ========================
            // MODAL CLOSE ON OVERLAY CLICK
            // ========================
            document
                .getElementById("tx-modal")
                .addEventListener("click", function (e) {
                    if (e.target === this) closeTxModal();
                });
            document
                .getElementById("goal-modal")
                .addEventListener("click", function (e) {
                    if (e.target === this) closeGoalModal();
                });
            document
                .getElementById("confirm-overlay")
                .addEventListener("click", function (e) {
                    if (e.target === this) closeConfirm();
                });

            // ========================
            // HELPERS
            // ========================
            function getActiveTab() {
                const active = document.querySelector(".nav-item.active");
                return active ? active.dataset.tab : "home";
            }

            // ========================
            // INIT
            // ========================
            loadState()
                .then(() => renderHome())
                .catch((e) => console.error("Erro ao inicializar:", e));
        </script>
    </body>
</html>
